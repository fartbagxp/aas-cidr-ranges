name: CIDR update cronjob

on:
  schedule:
    - cron: '*/15 20 * * *'

jobs:
  deploy:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: [3.8]

    steps:
      - uses: actions/checkout@v2

      - name: Setup Python ${{ matrix.python-version }}
        uses: actions/setup-python@v2
        with:
          python-version: ${{ matrix.python-version }}

      - name: Setup pipenv environment
        uses: dschep/install-pipenv-action@v1

      - name: Run an update in a pip environment
        run: |
          pipenv install --dev
          pipenv run python update_raw.py

      - name: Github commit update
        uses: stefanzweifel/git-auto-commit-action@v4
        if: steps.auto-commit-action.outputs.changes_detected == 'true'
        with:
          commit_message: Apply automatic changes
          branch: master

          commit_user_name: Github-Bot-Action
          commit_author: Github-Bot-Action
          skip_dirty_check: true
